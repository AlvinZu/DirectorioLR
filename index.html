<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DirectorioPro LR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  
  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-messaging-compat.js"></script>
  
  <!-- Icono App -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png">
    <link rel="apple-touch-icon" href="icon-180x180.png">
    <link rel="manifest" href="manifest.json">
  
    <style>
      /* Estilos para el selector de categorías */
#categoryFilter {
    min-width: 200px;
    transition: all 0.3s ease;
}

#categoryFilter:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Estilo para móviles */
@media (max-width: 640px) {
    #offersScreen .flex.items-center {
        margin: 1rem;
        flex-direction: column;
        align-items: flex-start;
    }
    
    #categoryFilter {
        margin-top: 2rem, 2rem;      
        width: 100%;
        
    }
  }
      /* Estilo para la flecha del dropdown */
#categoryFilter + div i {
    color: blue;
    right: 12px;
}
      
      /* Margen en la pantalla de ofertas */
#offersScreen {
    margin-left: 1rem; /* Margen izquierdo adicional si lo prefieres */
}

   /* Margen para móviles */
@media (min-width: 640px) {
    #offersScreen {
        margin-left: .8rem;
    }  
}
      
           
       /*Código base*/
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .search-highlight {
            background-color: #FEF08A;
        }
        
        /*Detalle de la corona*/
        .membership-badge {
            position: absolute;
            top: -12px;
            right: -12px;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: gold;
            background: black;
        }
      
        /*Detalle del borde de la tarjeta*/
        .premium-card {
            border: 4px solid black;
            position: relative;
            overflow: hidden;

        }
        
         /*Detalle de las estrellas*/
        .premium-card::after {
            content: '⭐⭐⭐⭐⭐';
            position: absolute;
            top: 10px;
            right: -30px;
            background: black;
            color: gold;
            padding: 2px 30px;
            transform: rotate(45deg);
            font-size: 12px;
            font-weight: bold;
        }
      
      /* Estilos para el slider */
.swiper {
    width: 100%;
    height: 200px;
}

.swiper-slide {
    position: relative;
    text-align: center;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
}

.swiper-slide img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.swiper-slide-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    color: white;
    padding: 1rem;
    text-align: left;
}

.swiper-button-next, .swiper-button-prev {
    color: white !important;
    background: rgba(0,0,0,0.5);
    padding: 1rem;
    border-radius: 50%;
}

.swiper-pagination-bullet-active {
    background: white !important;
}
      
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
  
  <!-- Login Screen -->
<div id="loginScreen" class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8 hidden">
  <div class="text-center mb-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-md">    
    <i class="fas fa-briefcase text-5xl text-blue-600"></i>
    <h1 class="text-3xl font-bold text-gray-800 mt-4">Bienvenido a DirectorioPro</h1>
    <p class="text-gray-500">Inicia sesión o regístrate para continuar</p>    
  </div>
  </div>

  <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
    <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
      <div class="space-y-6">
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">
            Correo electrónico
          </label>
          <div class="mt-1">
            <input id="email" name="email" type="email" autocomplete="email" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          </div>
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-gray-700">
            Contraseña
          </label>
          <div class="mt-1">
            <input id="password" name="password" type="password" autocomplete="current-password" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          </div>
        </div>

          

        <div>
          <button id="loginBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            Iniciar sesión
          </button>
        </div>
      </div>

      <div class="mt-6">
        <div class="relative">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-300"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-white text-gray-500">
              O inicia sesión con
            </span>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 gap-3">
          <div>
            <button id="googleSignIn" class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
              <img class="h-5 w-5 mr-2" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
              Google
            </button>
          </div>
        </div>
      </div>

      <div class="mt-6 text-center">
        <p class="text-sm text-gray-600">
          ¿No tienes una cuenta? 
          <button id="registerBtn" class="font-medium text-blue-600 hover:text-blue-500">
            Regístrate
          </button>
        </p>
      </div>
    </div>
  </div>
</div>
  
  
  <!-- Register Screen -->
<div id="registerScreen" class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8 hidden">
  <div class="text-center mb-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">    
      <i class="fas fa-briefcase text-5xl text-blue-600"></i>
      <h1 class="text-3xl font-bold text-gray-800 mt-4">Crear cuenta</h1>
      <p class="text-gray-500">Regístrate para acceder al directorio</p>    
    </div>
  </div>

  <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
    <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
      <div class="space-y-6">
        <div>
          <label for="registerEmail" class="block text-sm font-medium text-gray-700">
            Correo electrónico
          </label>
          <div class="mt-1">
            <input id="registerEmail" name="email" type="email" autocomplete="email" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          </div>
        </div>

        <div>
          <label for="registerPassword" class="block text-sm font-medium text-gray-700">
            Contraseña
          </label>
          <div class="mt-1">
            <input id="registerPassword" name="password" type="password" autocomplete="new-password" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          </div>
        </div>

        <div>
          <label for="confirmPassword" class="block text-sm font-medium text-gray-700">
            Confirmar contraseña
          </label>
          <div class="mt-1">
            <input id="confirmPassword" name="confirmPassword" type="password" autocomplete="new-password" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          </div>
        </div>

        <div>
          <label for="registerRole" class="block text-sm font-medium text-gray-700">
            ¿Eres un cliente o una empresa?
          </label>
          <div class="mt-1">
            <select id="registerRole" name="role" required class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
              <option value="client">Cliente</option>
            <!-- <option value="business">Empresa</option> -->
            </select>
          </div>
        </div>

        <div>
          <button id="registerSubmitBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            Registrarse
          </button>
        </div>
      </div>

      <div class="mt-6 text-center">
        <p class="text-sm text-gray-600">
          ¿Ya tienes una cuenta? 
          <button id="backToLogin" class="font-medium text-blue-600 hover:text-blue-500">
            Iniciar sesión
          </button>
        </p>
      </div>
    </div>
  </div>
</div>
  
  
  
          
    <header id="appHeader" class="bg-blue-600 text-white shadow-lg hidden">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-briefcase text-2xl"></i>
                <h1 class="text-xl font-bold">DirectorioPro Los Reyes</h1>
            </div>
            <nav class="hidden md:flex space-x-6">
                <button id="homeBtn" class="hover:text-blue-200 font-medium flex items-center">
                    <i class="fas fa-home mr-1"></i> Inicio
                </button>
                <button id="featuredBtn" class="hover:text-blue-200 font-medium flex items-center">
                    <i class="fas fa-star mr-1"></i> Destacados
                </button>
              <button id="offersBtn" class="hover:text-blue-200 font-medium flex items-center">
              <i class="fas fa-tag mr-1"></i> Ofertas Exclusivas
              </button>
              
            </nav>
            <button class="md:hidden text-xl" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden bg-blue-700 py-2 px-4">
          
            <button id="mobileHomeBtn" class="block w-full text-left py-2 hover:bg-blue-600 rounded px-2">
                <i class="fas fa-home mr-2"></i> Inicio
            </button>
            <button id="mobileFeaturedBtn" class="block w-full text-left py-2 hover:bg-blue-600 rounded px-2">
                <i class="fas fa-star mr-2"></i> Destacados
            </button>
            <button id="mobileOffersBtn" class="block w-full text-left py-2 hover:bg-blue-600 rounded px-2">
            <i class="fas fa-tag mr-2"></i> Ofertas Exclusivas
            </button>
            <button id="adminPanelBtn" class="hidden bg-yellow-400 text-black font-bold px-3 py-1 rounded hover:bg-yellow-500">
    <i class="fas fa-user-shield mr-1"></i> Admin
</button>
            <button id="mobileAccountBtn" class="block w-full text-left py-2 hover:bg-blue-600 rounded px-2">
        <i class="fas fa-user-circle mr-2"></i> Mi Cuenta
    </button>
          <button id="logoutBtn" class="hidden text-white hover:text-blue-200">
  <i class="fas fa-sign-out-alt mr-1"></i> Salir
</button>
        </div>
    </header>

  <!-- Home Screen -->
        <div id="homeScreen" class="fade-in">
  
  <!-- Slider de Empresas Destacadas -->
  <div id="sliderContainer">
    <section class="swiper mt-1">
        <div class="swiper-wrapper">
            <!-- Slides dinámicos se agregarán aquí con JavaScript -->
        </div>
      
        
        <!-- Navegación -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        
        <!-- Paginación -->
        <div class="swiper-pagination"></div>
    </section>
    </div>
  
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        
            <!-- Search Section -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8 -mt-4">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Encuentra profesionales cerca de ti</h2>
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="Buscar por nombre o categoría..." 
                           class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <i class="fas fa-search absolute right-4 top-4 text-gray-400"></i>
                </div>
                <div id="searchResults" class="hidden mt-2 border border-gray-200 rounded-lg max-h-60 overflow-y-auto"></div>
            </div>
            
            <!-- Sección de Categorías -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Explora por categorías</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" id="categoriesGrid">
                    <!-- Categories will be loaded here by JavaScript -->
                </div>
            </div>
            
            <!-- Featured Professionals Preview - Vista previa de profesionales destacados -->
            <div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Profesionales destacados</h2>
                    <button id="viewAllFeatured" class="text-blue-600 hover:underline">Ver todos</button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="featuredPreview">
                    <!-- La vista previa destacada se cargará aquí -->
                </div>
            </div>
        </div>
        
        <!-- Category Professionals Screen - Pantalla Categoría Profesionales -->
        <div id="categoryScreen" class="hidden fade-in">
          <div class="container mx-auto px-2 py-2">
            <div class="flex items-center mb-6">
                <button id="backFromCategory" class="mr-4 text-blue-600 hover:text-blue-800">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-gray-800" id="categoryTitle"></h2>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="professionalsGrid">
                <!-- Professionals will be loaded here by JavaScript -->
            </div>
        </div>
          </div>
        
        <!-- Professional Details Screen - Pantalla de detalles profesionales -->
        <div id="detailsScreen" class="hidden fade-in">
            <div class="flex items-center mb-6">
                <button id="backFromDetails" class="mr-4 text-blue-600 hover:text-blue-800">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-gray-800">Detalles del profesional</h2>
            </div>
            
            <div class="bg-white rounded-lg shadow-md overflow-hidden" id="professionalDetails">
                <!-- Details will be loaded here by JavaScript -->
            </div>
        </div>
        
        <!-- Featured Professionals Screen - Pantalla de profesionales destacados -->
        <div id="featuredScreen" class="hidden fade-in">
          <div class="container mx-auto px-2 py-2">
            <div class="flex items-center mb-6">
                <button id="backFromFeatured" class="mr-4 text-blue-600 hover:text-blue-800">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h2 class="text-2xl font-bold text-gray-800">Profesionales destacados</h2>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="featuredGrid">
                <!-- Featured professionals will be loaded here by JavaScript -->
            </div>
        </div>
          </div>
    </main>
    
    
               <!-- Offers Screen - Pantalla de Ofertas -->
<div id="offersScreen" class="hidden fade-in">
    <div class="flex items-center mb-6">
        <button id="backFromOffers" class="mr-4 text-blue-600 hover:text-blue-800">
            <i class="fas fa-arrow-left text-xl"></i>
        </button>
        <h2 class="text-2xl font-bold text-gray-800 mr-4">Ofertas Exclusivas</h2>
        <div class="relative">
            <select id="categoryFilter" 
                    class="appearance-none bg-white border border-gray-300 rounded-lg py-2 px-4 pr-8 leading-tight focus:outline-none focus:border-blue-500">
                <option value="all">Todas las categorías</option>
                <!-- Las opciones se generarán dinámicamente -->
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="offersGrid">
        <!-- Las ofertas se cargarán aquí -->
    </div>
</div>
  
  <!-- Pantalla de Mi Cuenta de perfil -->
  <div id="profileScreen" class="hidden fade-in bg-white md:bg-gray-50 min-h-screen">
    <div class="container mx-auto max-w-lg">        

        <div class="p-6 flex flex-col items-center space-y-4">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Mi Cuenta</h2>
            <div class="relative">
                <img id="profileImage" class="w-32 h-32 rounded-full object-cover border-4 border-gray-100 shadow-md" src="" alt="Foto de perfil">
                <div id="profileIconFallback" class="hidden w-32 h-32 rounded-full bg-blue-500 flex items-center justify-center border-4 border-gray-100 shadow-md">
                    <i class="fas fa-user text-6xl text-white"></i>
                </div>
            </div>

            <div class="text-center">
                <h3 id="profileName" class="text-2xl font-bold text-gray-900"></h3>
                <p id="profileEmail" class="text-gray-500"></p>
                <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold mt-2 px-2.5 py-0.5 rounded-full">Cliente</span>
            </div>

            <div class="flex items-center space-x-3 text-gray-600 bg-gray-100 px-4 py-2 rounded-lg">
                <i class="far fa-calendar-alt"></i>
                <span id="profileJoinedDate"></span>
            </div>

            <button id="enableNotificationsBtn" class="w-full flex justify-between items-center p-3 bg-green-400 hover:bg-green-500 rounded-lg mt-2">
    <span><i class="fas fa-bell mr-2"></i> Activar Notificaciones</span>
    <i class="fas fa-chevron-right text-gray-400"></i>
</button>
            <button id="profileSignOutBtn" class="w-full max-w-xs bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors shadow-lg">
                Cerrar Sesión
            </button>

            <div class="w-full max-w-xs pt-4 space-y-2">
                <button id="profileChangePasswordBtn" class="w-full flex justify-between items-center p-3 hover:bg-gray-100 rounded-lg">
                    <span>Cambiar Contraseña</span>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                </button>
                <button id="profileDeleteAccountBtn" class="w-full flex justify-between items-center p-3 hover:bg-gray-100 rounded-lg">
                    <span class="text-red-600">Eliminar Cuenta</span>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                </button>
            </div>
        </div>
    </div>
</div>
  
  <div id="adminScreen" class="hidden fade-in p-6">
    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Panel de Administrador</h1>
                <p class="text-gray-600">Gestiona los profesionales del directorio.</p>
            </div>
            <button id="addProfessionalBtn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                <i class="fas fa-plus mr-2"></i> Agregar Profesional
            </button>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-x-auto">
            <table class="w-full table-auto">
                <thead class="bg-gray-50 border-b-2 border-gray-200">
                    <tr>
                        <th class="p-3 text-sm font-semibold tracking-wide text-left">Nombre</th>
                        <th class="p-3 text-sm font-semibold tracking-wide text-left">Categoría</th>
                        <th class="p-3 text-sm font-semibold tracking-wide text-left">Membresía</th>
                        <th class="p-3 text-sm font-semibold tracking-wide text-left">Acciones</th>
                    </tr>
                </thead>
                <tbody id="adminProfessionalsList">
                    <tr><td colspan="4" class="p-4 text-center text-gray-500">Cargando...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
  
  <div id="professionalModal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b">
            <h2 id="modalTitle" class="text-2xl font-bold">Agregar Nuevo Profesional</h2>
        </div>
        <form id="professionalForm" class="p-6 space-y-4">
            <input type="hidden" id="professionalId">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="profName" placeholder="Nombre del Profesional" class="p-2 border rounded w-full" required>
                <input type="text" id="profCategory" placeholder="Categoría (Ej: Dentistas)" class="p-2 border rounded w-full" required>
                <input type="text" id="profSpecialty" placeholder="Especialidad" class="p-2 border rounded w-full">
                <input type="text" id="profPhone" placeholder="Teléfono" class="p-2 border rounded w-full">
                <input type="text" id="profAddress" placeholder="Dirección" class="p-2 border rounded w-full">
                <input type="text" id="profSchedule" placeholder="Horario" class="p-2 border rounded w-full">
                <input type="text" id="profPrice" placeholder="Precio o texto (Ej: Agenda Ahora)" class="p-2 border rounded w-full">
                <input type="text" id="profExperience" placeholder="Experiencia" class="p-2 border rounded w-full">
                <input type="text" id="profEducation" placeholder="Educación" class="p-2 border rounded w-full">
                <input type="text" id="profImage" placeholder="URL de la Imagen de Perfil" class="p-2 border rounded w-full">
            </div>
            
            <textarea id="profDescription" placeholder="Descripción" class="p-2 border rounded w-full h-24"></textarea>
            <textarea id="profServices" placeholder="Servicios (separados por coma)" class="p-2 border rounded w-full h-24"></textarea>
            <textarea id="profGallery" placeholder="URLs de Galería (separadas por coma)" class="p-2 border rounded w-full h-24"></textarea>
            
            <div class="flex items-center space-x-6 pt-2">
                <div class="flex items-center">
                    <input type="checkbox" id="profFeatured" class="mr-2 h-5 w-5">
                    <label for="profFeatured">Destacado</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="profPremium" class="mr-2 h-5 w-5">
                    <label for="profPremium">Membresía Premium</label>
                </div>
                 <div class="flex items-center">
                    <input type="checkbox" id="profShowInSlider" class="mr-2 h-5 w-5">
                    <label for="profShowInSlider">Mostrar en Slider</label>
                </div>
            </div>

            <div class="pt-4 flex justify-end space-x-3">
                <button type="button" id="cancelProfessionalBtn" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">Cancelar</button>
                <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Guardar Cambios</button>
            </div>
        </form>
    </div>
</div>
              
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">DirectorioPro Los Reyes</h3>
                    <p class="text-gray-300">Conectando profesionales con clientes desde 2025.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Enlaces rápidos</h3>
                    <ul class="space-y-2">
                        <li><button id="footerHomeBtn" class="text-gray-300 hover:text-white">Inicio</button></li>
                        <li><button id="footerFeaturedBtn" class="text-gray-300 hover:text-white">Destacados</button></li>
                        
                    </ul>
                </div>
              
                <div>
                    <h3 class="text-xl font-bold mb-4">Contacto</h3>
                    <p class="text-gray-300"><i class="fas fa-phone mr-2"></i>4434770618</p>
                  
                  <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                    <h3 class="text-xl font-bold mb-4">Anunciate con Nosotros</h3>
                    <p class="text-gray-300">Tenemos Planes de 6 meses y 1 Año a un super precio.</p>
                </div>
            </div>
            
            <!-- Lightbox -->
<div id="lightbox" class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4">
    <div class="max-w-4xl w-full relative">
        <img id="lightbox-img" src="" alt="" class="rounded-lg max-h-[80vh] mx-auto">
        <button onclick="closeLightbox()" class="absolute -top-8 right-0 text-white text-2xl hover:text-gray-300">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>
                            
        </div>
    </footer>
    
    <script>
      // =======================================================================
// SCRIPT COMPLETO, LIMPIO Y CORREGIDO PARA DIRECTORIO PRO
// =======================================================================

// --- 1. VARIABLES GLOBALES Y CONFIGURACIÓN ---
let professionals = []; // Almacenará los perfiles cargados desde Firestore.
const contactConfig = {
    'Dentistas': ['call'], 'Nutriólogos': ['whatsapp'], 'Quiroprácticos': ['whatsapp'], 'Doctores': ['call'], 'Fisioterapeutas': ['whatsapp', 'call'], 'Tiendas de ropa': ['whatsapp', 'call'], 'Venta de suplementos': ['whatsapp'], 'Barberías': ['whatsapp', 'call'], 'Tiendas de Pinturas': ['call'], 'Carpinteros': ['whatsapp'], 'Electricistas': ['whatsapp', 'call'], 'Plomeros': ['call'], 'Fotógrafos': ['call'], 'Protección Civil': ['call'], 'Abogados': ['whatsapp'], 'Psicólogos': ['whatsapp', 'call'], 'Veterinarios': ['whatsapp', 'call'], 'Mecánicos': ['call'], 'Técnicos en Computadoras': ['whatsapp'], 'Tatuadores': ['whatsapp', 'call'], 'Restaurantes': ['call'], 'Pezcaderías': ['call'], 'Construcción': ['whatsapp', 'call'],'Arquitectos': ['whatsapp', 'call'], 'Rotulistas': ['whatsapp'], 'Llanteras': ['call'], 'Sitios de Taxis': ['call'], 'Masajistas': ['whatsapp'], 'Vinaterías': ['call'], 'Vidrierías': ['whatsapp', 'call'], 'Herreros': ['call'], 'Ferreterías': ['whatsapp', 'call'], 'Loncherías': ['call'], 'Lavanderías': ['whatsapp', 'call'],'Pastelerías': ['call'], 'Cafeterías': ['call'], 'Pizzerías': ['call'], 'Pollerías': ['call'], 'Carnicerías': ['whatsapp', 'call'], 'Papelerías': ['whatsapp', 'call'], 'Imprentas': ['call'], 'Hoteles': ['call'], 'Talleres de Motos': ['call'], 'Productos de Limpieza': ['call'], 'Purificadoras':['whatsapp', 'call'], 'Policías': ['call'], 'Ambulancias': ['call'],'Panaderías': ['whatsapp', 'call'],'Reparación de Celulares': ['whatsapp', 'call'],'Agencias de Viajes':['call'],'Refaccionarias':['whatsapp', 'call'],'Florerías':['whatsapp', 'call'],'Podólogos':['whatsapp', 'call'],'Quintas':['whatsapp', 'call'],'Renta de Muebles':['whatsapp', 'call'],'Músicos': ['whatsapp', 'call'],'Tablaroqueros': ['whatsapp', 'call'],'Renta de Inflables': ['whatsapp', 'call'],'Cámaras de Seguridad': ['whatsapp', 'call'],'Paneles Solares': ['whatsapp', 'call'],'Auto Lavados': ['whatsapp', 'call'],'Funerarias': ['call'],'Cruz Roja': ['call'],'Escuelas de Ingles': ['whatsapp', 'call'],'Cerrajeros': ['whatsapp', 'call'],'Deportes': ['whatsapp', 'call'],'Perfumerías': ['whatsapp'],'Hospitales': ['call'],'Belleza': ['whatsapp', 'call'],'Productos de Belleza': ['whatsapp', 'call'],'Joyerías': ['whatsapp', 'call'],'Comida Rápida': ['whatsapp', 'call'],'Aires Acondicionados': ['whatsapp', 'call'],'Sociedad Cooperativa de Ahorros y Préstamos': ['call'],'Ginecólogos': ['whatsapp', 'call'],'Supermercados': ['call']
};
const firebaseConfig = {
    apiKey: "AIzaSyBM91yvFBEU9NDSEZKQyFHU6bhqCPgY3Uc",
    authDomain: "directoriopro-los-reyes.firebaseapp.com",
    projectId: "directoriopro-los-reyes",
    storageBucket: "directoriopro-los-reyes.firebasestorage.app",
    messagingSenderId: "689785400797",
    appId: "1:689785400797:web:5b91b320d6aa70ae669a34"
};

// --- 2. INICIALIZACIÓN DE FIREBASE Y SERVICIOS ---
firebase.initializeApp(firebaseConfig);
const analytics = firebase.analytics();
const auth = firebase.auth();
const db = firebase.firestore();
const messaging = firebase.messaging();

// --- 3. REFERENCIAS A ELEMENTOS DEL DOM (CACHE) ---
const homeScreen = document.getElementById('homeScreen');
const categoryScreen = document.getElementById('categoryScreen');
const detailsScreen = document.getElementById('detailsScreen');
const featuredScreen = document.getElementById('featuredScreen');
const offersScreen = document.getElementById('offersScreen');
const profileScreen = document.getElementById('profileScreen');
const adminScreen = document.getElementById('adminScreen');
const categoriesGrid = document.getElementById('categoriesGrid');
const professionalsGrid = document.getElementById('professionalsGrid');
const professionalDetails = document.getElementById('professionalDetails');
const featuredGrid = document.getElementById('featuredGrid');
const featuredPreview = document.getElementById('featuredPreview');
const searchInput = document.getElementById('searchInput');
const searchResults = document.getElementById('searchResults');
const categoryTitle = document.getElementById('categoryTitle');
const mobileMenu = document.getElementById('mobileMenu');

// --- 4. LÓGICA DE DATOS Y AUTENTICACIÓN ---

// Carga los perfiles desde Firestore.
async function loadProfessionalsFromFirestore() {
    try {
        const snapshot = await db.collection('professionals').orderBy('name').get();
        professionals = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        console.log(`DirectorioPro: ${professionals.length} perfiles cargados.`);
    } catch (error) {
        console.error("Error crítico al cargar perfiles: ", error);
        alert("No se pudieron cargar los datos. Por favor, recarga la página.");
    }
}

// Observador del estado de autenticación (Maneja quién está logueado).
let currentUser = null;
let userRole = null;
let isCurrentUserAdmin = false;
auth.onAuthStateChanged(user => {
    if (user) {
        currentUser = user;
        db.collection('users').doc(user.uid).get().then(doc => {
            if (doc.exists) {
                userRole = doc.data().role;
                isCurrentUserAdmin = doc.data().isAdmin === true;
                document.getElementById('appHeader').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('adminPanelBtn').classList.toggle('hidden', !isCurrentUserAdmin);
                handleInitialScreen();
            }
        });
    } else {
        currentUser = null;
        userRole = null;
        isCurrentUserAdmin = false;
        document.getElementById('appHeader').classList.add('hidden');
        document.getElementById('logoutBtn').classList.add('hidden');
        showScreen('login');
    }
});

// --- 5. FUNCIONES DE RENDERIZADO Y UI ---

// Controla qué pantalla principal se muestra.
function showScreen(screen, pushState = true) {
    const screens = [homeScreen, categoryScreen, detailsScreen, featuredScreen, offersScreen, profileScreen, adminScreen, document.getElementById('loginScreen'), document.getElementById('registerScreen')];
    screens.forEach(s => s.classList.add('hidden'));
    document.getElementById('sliderContainer').classList.add('hidden');

    if (!currentUser && !['login', 'register'].includes(screen)) {
        document.getElementById('loginScreen').classList.remove('hidden');
        return;
    }

    switch(screen) {
        case 'home':
            homeScreen.classList.remove('hidden');
            document.getElementById('sliderContainer').classList.remove('hidden');
            break;
        case 'details': detailsScreen.classList.remove('hidden'); break;
        case 'admin':
            if (isCurrentUserAdmin) {
                adminScreen.classList.remove('hidden');
                cargarProfesionalesEnAdmin();
            } else {
                alert("Acceso denegado.");
                showScreen('home');
            }
            break;
        // Agrega los demás casos que necesites.
        default:
            const currentScreen = document.getElementById(screen + 'Screen');
            if (currentScreen) currentScreen.classList.remove('hidden');
            else homeScreen.classList.remove('hidden'); // Pantalla por defecto
    }
    
    if (pushState) history.pushState({ screen: screen }, '', `#${screen}`);
    window.scrollTo(0, 0);
}

// Carga las tarjetas de categorías en la pantalla de inicio.
function loadCategories() {
    const categories = [...new Set(professionals.map(pro => pro.category))].sort();
    categoriesGrid.innerHTML = '';
    categories.forEach(category => {
        const icon = getCategoryIcon(category);
        const categoryElement = document.createElement('div');
        categoryElement.className = 'bg-white rounded-lg shadow-md p-4 flex flex-col items-center justify-center text-center cursor-pointer hover:shadow-lg transition-shadow';
        categoryElement.innerHTML = `<div class="text-4xl text-blue-600 mb-2">${icon}</div><h3 class="text-md font-medium">${category}</h3>`;
        categoryElement.addEventListener('click', () => showCategoryProfessionals(category));
        categoriesGrid.appendChild(categoryElement);
    });
}

// Muestra los profesionales de una categoría seleccionada.
function showCategoryProfessionals(category) {
    const categoryPros = professionals.filter(pro => pro.category === category);
    categoryTitle.textContent = category;
    professionalsGrid.innerHTML = '';
    categoryPros.forEach(pro => professionalsGrid.appendChild(createProfessionalCard(pro)));
    showScreen('category');
}

// Muestra una vista previa de los profesionales destacados.
function loadFeaturedPreview() {
    const featuredPros = professionals.filter(pro => pro.featured).slice(0, 3);
    featuredPreview.innerHTML = '';
    featuredPros.forEach(pro => featuredPreview.appendChild(createProfessionalCard(pro)));
}

// Muestra todos los profesionales destacados en su propia pantalla.
function showAllFeatured() {
    const featuredPros = professionals.filter(pro => pro.featured);
    featuredGrid.innerHTML = '';
    featuredPros.forEach(pro => featuredGrid.appendChild(createProfessionalCard(pro)));
    showScreen('featured');
}

// Crea el HTML para una tarjeta de profesional individual.
function createProfessionalCard(professional) {
    const card = document.createElement('div');
    const isPremium = professional.membership === true || professional.membership === 'premium';
    card.className = `bg-white rounded-lg shadow-md overflow-hidden ${isPremium ? 'premium-card' : ''}`;
    
    card.innerHTML = `
        <div class="relative">
            <img src="${professional.image || './Images/Logo.jpg'}" alt="${professional.name}" class="w-full h-48 object-cover">
            ${isPremium ? '' : `<div class="membership-badge bg-gray-200 text-gray-800"><i class="fas fa-user"></i></div>`}
        </div>
        <div class="p-4">
            <h3 class="text-xl font-bold mb-1">${professional.name}</h3>
            <p class="text-blue-600 font-medium mb-2">${professional.specialty || ''}</p>
            <p class="text-gray-600 text-sm mb-3 line-clamp-2">${professional.description || ''}</p>
            <div class="flex justify-between items-center">
                <span class="text-gray-800 font-medium">${professional.price || ''}</span>
                <button class="details-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" data-id="${professional.id}">
                    Ver Detalles
                </button>
            </div>
        </div>`;
    return card;
}

// Muestra la pantalla de detalles de un profesional.
function showProfessionalDetails(id) {
    const professional = professionals.find(pro => pro.id === id);
    if (!professional) {
        alert("Profesional no encontrado. El directorio puede estar actualizándose.");
        return;
    }
    
    analytics.logEvent('view_item', { item_id: `prof_${id}`, item_name: professional.name });
    
    const isPremium = professional.membership === true || professional.membership === 'premium';
    const servicesHTML = (professional.services?.length > 0)
        ? professional.services.map(s => `<li><i class="fas fa-check text-blue-500 mr-2"></i>${s}</li>`).join('')
        : '<li>Servicios no especificados.</li>';
    const galleryHTML = (isPremium && professional.gallery?.length > 0) ? `
        <div class="mt-8">
            <h4 class="text-xl font-bold mb-4">Galería</h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                ${professional.gallery.map(img => `<img src="${img}" alt="Foto de ${professional.name}" class="cursor-pointer w-full h-32 object-cover rounded-lg shadow-md" onclick="showLightbox('${img}')">`).join('')}
            </div>
        </div>` : '';

    professionalDetails.innerHTML = `
        <div class="md:flex">
            <div class="md:w-1/3 bg-gray-100 p-6 flex flex-col items-center text-center">
                <div class="relative mb-4">
                    <img src="${professional.image || './Images/Logo.jpg'}" alt="${professional.name}" class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-md">
                    ${isPremium ? `<div class="membership-badge"><i class="fas fa-crown"></i></div>` : ''}
                </div>
                <h3 class="text-2xl font-bold">${professional.name}</h3>
                <p class="text-blue-600 font-medium">${professional.specialty || ''}</p>
                <p class="text-gray-600 mt-2">${professional.category}</p>
                <div class="mt-6 w-full space-y-3">
                    ${generateContactButtons(professional)}
                    <button id="shareBtn" data-id="${id}" class="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg w-full flex items-center justify-center hover:bg-yellow-600">
                        <i class="fas fa-share-alt mr-2"></i>Compartir
                    </button>
                </div>
            </div>
            <div class="md:w-2/3 p-6">
                <div class="mb-6"><h4 class="text-lg font-bold mb-2">Sobre mí</h4><p>${professional.description || 'No disponible.'}</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div><h4 class="text-lg font-bold mb-2">Servicios</h4><ul class="space-y-1 text-gray-700">${servicesHTML}</ul></div>
                    <div>
                        <h4 class="text-lg font-bold mb-2">Horario</h4><p class="text-gray-700"><i class="far fa-clock mr-2"></i>${professional.schedule || 'No especificado'}</p>
                        <h4 class="text-lg font-bold mt-4 mb-2">Experiencia</h4><p class="text-gray-700"><i class="fas fa-briefcase mr-2"></i>${professional.experience || 'No especificada'}</p>
                    </div>
                </div>
                ${professional.education ? `<div class="mb-6"><h4 class="text-lg font-bold mb-2">Educación</h4><p class="text-gray-700"><i class="fas fa-graduation-cap mr-2"></i>${professional.education}</p></div>` : ''}
                <div><h4 class="text-lg font-bold mb-2">Ubicación</h4><p class="text-gray-700"><i class="fas fa-map-marker-alt mr-2"></i>${professional.address || 'No especificada'}</p></div>
                ${galleryHTML}
            </div>
        </div>`;
    showScreen('details');
}

// Inicializa y controla el slider de Swiper.
function initSwiper() {
    const sliderCompanies = professionals.filter(pro => pro.showInSlider && pro.image);
    const swiperWrapper = document.querySelector('.swiper-wrapper');
    if (!swiperWrapper) return;

    swiperWrapper.innerHTML = sliderCompanies.map(company => `
        <div class="swiper-slide">
            <img src="${company.image}" alt="${company.name}">
            <div class="swiper-slide-content">
                <h3 class="text-xl font-bold">${company.name}</h3>
                <button class="swiper-details-btn mt-2 bg-white/20 backdrop-blur-sm px-4 py-1 rounded-full text-xs" data-id="${company.id}">Ver Perfil</button>
            </div>
        </div>`).join('');

    new Swiper('.swiper', {
        loop: sliderCompanies.length > 1, // El loop solo tiene sentido si hay más de 1 slide
        autoplay: { delay: 3000 },
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
        pagination: { el: '.swiper-pagination', clickable: true },
        slidesPerView: 1, spaceBetween: 10,
        breakpoints: { 640: { slidesPerView: 2, spaceBetween: 20 }, 1024: { slidesPerView: 3, spaceBetween: 30 } }
    });
}

// --- 6. FUNCIONES DE AYUDA Y UTILIDADES ---

// Devuelve el HTML del ícono para una categoría.
function getCategoryIcon(category) {
    const icons = { 'Dentistas': '<i class="fas fa-tooth"></i>', 'Nutriólogos': '<i class="fas fa-apple-alt"></i>', 'Quiroprácticos': '<i class="fas fa-bone"></i>', 'Doctores': '<i class="fas fa-user-md"></i>', 'Fisioterapeutas': '<i class="fas fa-hand-holding-heart"></i>', 'Tiendas de ropa': '<i class="fas fa-tshirt"></i>', 'Tiendas de suplementos': '<i class="fas fa-pills"></i>', 'Barberías': '<i class="fas fa-cut"></i>', 'Tiendas de Pinturas': '<i class="fas fa-paint-roller"></i>', 'Carpinteros': '<i class="fas fa-hammer"></i>', 'Electricistas': '<i class="fas fa-bolt"></i>', 'Plomeros': '<i class="fas fa-faucet"></i>', 'Fotógrafos': '<i class="fas fa-camera-retro"></i>', 'Protección Civil': '<i class="fas fa-shield-alt"></i>', 'Abogados': '<i class="fas fa-gavel"></i>', 'Psicólogos': '<i class="fas fa-brain"></i>', 'Veterinarios': '<i class="fas fa-paw"></i>', 'Mecánicos': '<i class="fas fa-car"></i>', 'Técnicos en Computadoras': '<i class="fas fa-laptop"></i>', 'Tatuadores': '<i class="fas fa-dragon"></i>', 'Restaurantes': '<i class="fas fa-utensils"></i>', 'Pezcaderías': '<i class="fas fa-shrimp"></i>', 'Construcción': '<i class="fas fa-hard-hat"></i>', 'Arquitectos': '<i class="fas fa-drafting-compass"></i>', 'Rotulistas': '<i class="fas fa-paint-brush"></i>', 'Llanteras': '<i class="fas fa-car"></i>', 'Sitios de Taxis': '<i class="fas fa-taxi"></i>', 'Masajistas': '<i class="fas fa-spa"></i>', 'Vinaterías': '<i class="fas fa-wine-bottle"></i>', 'Vidrierías': '<i class="fas fa-store"></i>', 'Herreros': '<i class="fas fa-tools"></i>', 'Ferreterías': '<i class="fas fa-toolbox"></i>', 'Loncherías': '<i class="fas fa-bread-slice"></i>', 'Lavanderías': '<i class="fas fa-soap"></i>', 'Pastelerías': '<i class="fas fa-birthday-cake"></i>', 'Cafeterías': '<i class="fas fa-coffee"></i>', 'Pizzerías': '<i class="fas fa-pizza-slice"></i>', 'Pollerías': '<i class="fas fa-drumstick-bite"></i>', 'Carnicerías': '<i class="fas fa-drumstick-bite"></i>', 'Papelerías': '<i class="fas fa-pencil"></i>', 'Imprentas': '<i class="fas fa-print"></i>', 'Hoteles': '<i class="fas fa-hotel"></i>', 'Talleres de Motos': '<i class="fas fa-motorcycle"></i>', 'Productos de Limpieza': '<i class="fas fa-broom"></i>', 'Purificadoras de Agua': '<i class="fas fa-water"></i>', 'Policías': '<i class="fas fa-shield-alt"></i>', 'Ambulancias': '<i class="fas fa-ambulance"></i>', 'Panaderías': '<i class="fas fa-bread-slice"></i>', 'Reparación de Celulares': '<i class="fas fa-mobile-alt"></i>', 'Agencias de Viajes': '<i class="fas fa-plane-departure"></i>', 'Refaccionarias': '<i class="fas fa-car-side"></i>', 'Florerías': '<i class="fas fa-spa"></i>', 'Podólogos': '<i class="fas fa-shoe-prints"></i>', 'Quintas': '<i class="fas fa-home"></i>', 'Renta de Muebles': '<i class="fas fa-couch"></i>', 'Músicos': '<i class="fas fa-music"></i>', 'Tablaroqueros': '<i class="fas fa-border-style"></i>', 'Renta de Inflables': '<i class="fas fa-cloud"></i>', 'Cámaras de Seguridad': '<i class="fas fa-camera"></i>', 'Paneles Solares': '<i class="fas fa-solar-panel"></i>', 'Auto Lavados': '<i class="fas fa-car"></i>', 'Funerarias': '<i class="fas fa-monument"></i>', 'Cruz Roja': '<i class="fas fa-cross"></i>', 'Escuelas de Ingles': '<i class="fas fa-language"></i>', 'Cerrajeros': '<i class="fas fa-key"></i>', 'Deportes': '<i class="fas fa-medal"></i>', 'Perfumerías': '<i class="fas fa-spray-can-sparkles"></i>', 'Hospitales': '<i class="fas fa-hospital"></i>', 'Belleza': '<i class="fas fa-crown"></i>', 'Productos de Belleza': '<i class="fas fa-spa"></i>', 'Joyerías': '<i class="fas fa-gem"></i>', 'Comida Rápida': '<i class="fas fa-hamburger"></i>', 'Aires Acondicionados': '<i class="fas fa-fan"></i>', 'Sociedad Cooperativa de Ahorros y Préstamos': '<i class="fas fa-coins"></i>', 'Ginecólogos': '<i class="fas fa-venus-mars"></i>', 'Supermercados': '<i class="fas fa-shopping-cart"></i>' };
    return icons[category] || '<i class="fas fa-briefcase"></i>';
}

// Genera los botones de contacto (WhatsApp, Llamada) para un perfil.
function generateContactButtons(professional) {
    const config = contactConfig[professional.category] || ['call'];
    const phoneNumber = professional.phone ? professional.phone.replace(/\D/g, '') : '';
    const encodedName = encodeURIComponent(professional.name);
    return config.map(method => {
        if (method === 'whatsapp') {
            return `<a href="https://wa.me/${phoneNumber}?text=Hola%20${encodedName},%20vi%20tu%20perfil%20en%20DirectorioPro" target="_blank" class="block bg-green-500 text-white text-center py-3 rounded-lg hover:bg-green-600"><i class="fab fa-whatsapp mr-2"></i>WhatsApp</a>`;
        }
        if (method === 'call') {
            const isEmergency = ['Policías', 'Ambulancias', 'Cruz Roja', 'Protección Civil'].includes(professional.category);
            return `<a href="tel:${phoneNumber}" class="block ${isEmergency ? 'bg-red-500' : 'bg-blue-500'} text-white text-center py-3 rounded-lg"><i class="fas fa-phone mr-2"></i>${isEmergency ? 'Llamada de Emergencia' : 'Llamar'}</a>`;
        }
        return '';
    }).join('');
}

// Funciones para el Lightbox de la galería de imágenes.
function showLightbox(imgUrl) { document.getElementById('lightbox-img').src = imgUrl; document.getElementById('lightbox').classList.remove('hidden'); }
function closeLightbox() { document.getElementById('lightbox').classList.add('hidden'); }

// Función para compartir un perfil.
async function shareProfessional(id) {
    const pro = professionals.find(p => p.id === id);
    if (!pro) return;
    try {
        await navigator.share({ title: 'DirectorioPro Los Reyes', text: `¡Te recomiendo a "${pro.name}"!`, url: `https://alvinzu.github.io/DirectorioLR/?id=${id}` });
    } catch (err) {
        console.error('Error al compartir:', err);
    }
}

// --- 7. PANEL DE ADMINISTRADOR ---

// Carga los datos en la tabla del panel de admin.
function cargarProfesionalesEnAdmin() {
    const listContainer = document.getElementById('adminProfessionalsList');
    if (!listContainer) return;
    const sortedProfessionals = [...professionals].sort((a, b) => a.name.localeCompare(b.name));
    listContainer.innerHTML = sortedProfessionals.map(pro => `
        <tr class="border-b hover:bg-gray-50">
            <td class="p-3 text-sm font-medium">${pro.name}</td>
            <td class="p-3 text-sm">${pro.category}</td>
            <td class="p-3 text-sm"><span class="p-1.5 text-xs font-medium uppercase rounded-md ${pro.membership ? 'bg-yellow-200 text-yellow-800' : 'bg-gray-200'}">${pro.membership ? 'Premium' : 'Gratis'}</span></td>
            <td class="p-3 text-sm"><button class="edit-btn text-blue-600 font-semibold" data-id="${pro.id}">Editar</button><button class="delete-btn text-red-600 font-semibold ml-4" data-id="${pro.id}">Eliminar</button></td>
        </tr>`).join('') || '<tr><td colspan="4" class="p-4 text-center">No hay profesionales.</td></tr>';
}

// Abre el modal para crear o editar un perfil.
function openProfessionalModal(id = null) {
    const form = document.getElementById('professionalForm');
    form.reset();
    document.getElementById('professionalId').value = id || '';
    if (id) {
        const pro = professionals.find(p => p.id === id);
        if (pro) {
            document.getElementById('modalTitle').textContent = "Editar Profesional";
            Object.keys(pro).forEach(key => {
                const input = form.elements[`prof${key.charAt(0).toUpperCase() + key.slice(1)}`];
                if (input) {
                    if (input.type === 'checkbox') input.checked = pro[key];
                    else input.value = Array.isArray(pro[key]) ? pro[key].join(', ') : pro[key];
                }
            });
            // Renombrar el campo `profPremium` a `profMembership` para que coincida.
            document.getElementById('profPremium').checked = pro.membership === true;
        }
    } else {
        document.getElementById('modalTitle').textContent = "Agregar Profesional";
    }
    document.getElementById('professionalModal').classList.remove('hidden');
}

// Cierra el modal de edición/creación.
function closeProfessionalModal() {
    document.getElementById('professionalModal').classList.add('hidden');
}

// Guarda un perfil (nuevo o editado) en Firestore.
async function saveProfessional(event) {
    event.preventDefault();
    const id = document.getElementById('professionalId').value;
    const proData = {
        name: document.getElementById('profName').value,
        category: document.getElementById('profCategory').value,
        specialty: document.getElementById('profSpecialty').value,
        phone: document.getElementById('profPhone').value,
        address: document.getElementById('profAddress').value,
        schedule: document.getElementById('profSchedule').value,
        price: document.getElementById('profPrice').value,
        experience: document.getElementById('profExperience').value,
        education: document.getElementById('profEducation').value,
        image: document.getElementById('profImage').value,
        description: document.getElementById('profDescription').value,
        services: document.getElementById('profServices').value.split(',').map(s => s.trim()).filter(Boolean),
        gallery: document.getElementById('profGallery').value.split(',').map(s => s.trim()).filter(Boolean),
        featured: document.getElementById('profFeatured').checked,
        membership: document.getElementById('profPremium').checked,
        showInSlider: document.getElementById('profShowInSlider').checked,
    };

    try {
        const action = id ? db.collection('professionals').doc(id).set(proData, { merge: true }) : db.collection('professionals').add(proData);
        await action;
        alert(`Profesional ${id ? 'actualizado' : 'agregado'} con éxito.`);
        closeProfessionalModal();
        await loadProfessionalsFromFirestore();
        cargarProfesionalesEnAdmin();
    } catch (error) {
        console.error("Error al guardar:", error);
        alert("Ocurrió un error al guardar.");
    }
}

// Elimina un perfil de Firestore.
async function deleteProfessional(id) {
    if (confirm("¿Estás seguro? Esta acción es irreversible.")) {
        try {
            await db.collection('professionals').doc(id).delete();
            alert("Profesional eliminado.");
            professionals = professionals.filter(p => p.id !== id);
            cargarProfesionalesEnAdmin(); 
        } catch (error) {
            console.error("Error al eliminar:", error);
        }
    }
}

// --- 8. MANEJO DE EVENTOS ---

// Configura todos los event listeners de la aplicación.
function setupEventListeners() {
    // Navegación principal y móvil
    document.getElementById('homeBtn').addEventListener('click', () => showScreen('home'));
    document.getElementById('featuredBtn').addEventListener('click', showAllFeatured);
    document.getElementById('offersBtn').addEventListener('click', () => showScreen('offers'));
    document.getElementById('adminPanelBtn').addEventListener('click', () => showScreen('admin'));
    document.getElementById('mobileMenuBtn').addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
    
    // Navegación desde el menú móvil
    document.querySelectorAll('#mobileHomeBtn, #footerHomeBtn').forEach(btn => btn.addEventListener('click', () => { showScreen('home'); mobileMenu.classList.add('hidden'); }));
    document.querySelectorAll('#mobileFeaturedBtn, #footerFeaturedBtn').forEach(btn => btn.addEventListener('click', () => { showAllFeatured(); mobileMenu.classList.add('hidden'); }));
    document.getElementById('mobileOffersBtn').addEventListener('click', () => { showScreen('offers'); mobileMenu.classList.add('hidden'); });
    
    // Botones de "Atrás"
    document.getElementById('backFromCategory').addEventListener('click', () => history.back());
    document.getElementById('backFromDetails').addEventListener('click', () => history.back());
    document.getElementById('backFromFeatured').addEventListener('click', () => history.back());
    document.getElementById('backFromOffers').addEventListener('click', () => history.back());

    // Botones de Perfil de Usuario
    document.getElementById('mobileAccountBtn').addEventListener('click', () => { showScreen('profile'); mobileMenu.classList.add('hidden'); });
    document.getElementById('profileSignOutBtn').addEventListener('click', () => { if (confirm("¿Cerrar sesión?")) auth.signOut(); });
    // Aquí puedes agregar los listeners para cambiar contraseña y eliminar cuenta.

    // Listener delegado para todos los botones de "Ver Detalles" y "Compartir"
    document.addEventListener('click', e => {
        const detailsBtn = e.target.closest('.details-btn, .swiper-details-btn');
        if (detailsBtn) showProfessionalDetails(detailsBtn.dataset.id);

        const shareBtn = e.target.closest('#shareBtn');
        if (shareBtn) shareProfessional(shareBtn.dataset.id);
    });

    // Listeners del Panel de Administrador
    document.getElementById('addProfessionalBtn')?.addEventListener('click', () => openProfessionalModal());
    document.getElementById('cancelProfessionalBtn')?.addEventListener('click', closeProfessionalModal);
    document.getElementById('professionalForm')?.addEventListener('submit', saveProfessional);
    document.getElementById('adminProfessionalsList')?.addEventListener('click', e => {
        if (e.target.closest('.edit-btn')) openProfessionalModal(e.target.closest('.edit-btn').dataset.id);
        if (e.target.closest('.delete-btn')) deleteProfessional(e.target.closest('.delete-btn').dataset.id);
    });
    
    setupSearch();
}

// Configura la barra de búsqueda.
function setupSearch() {
    searchInput.addEventListener('input', () => {
        const query = searchInput.value.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        if (query.length === 0) {
            searchResults.classList.add('hidden');
            return;
        }

        const categories = [...new Set(professionals.map(pro => pro.category))];
        
        const proResults = professionals.filter(pro => 
            pro.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query) ||
            pro.category.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query) ||
            (pro.specialty && pro.specialty.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query))
        ).map(pro => ({ type: 'professional', ...pro }));

        const catResults = categories.filter(cat => 
            cat.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(query)
        ).map(cat => ({ type: 'category', name: cat }));

        const allResults = [...proResults, ...catResults];
        
        if (allResults.length > 0) {
            searchResults.innerHTML = allResults.map(result => {
                if (result.type === 'category') {
                    return `<div class="p-3 hover:bg-gray-100 cursor-pointer" onclick="showCategoryProfessionals('${result.name}'); searchResults.classList.add('hidden');"><i class="fas fa-folder mr-3 text-blue-500"></i>${result.name}</div>`;
                }
                return `<div class="p-3 hover:bg-gray-100 cursor-pointer" onclick="showProfessionalDetails('${result.id}'); searchResults.classList.add('hidden');"><i class="fas fa-user mr-3 text-gray-400"></i>${result.name} <span class="text-sm text-gray-500">- ${result.category}</span></div>`;
            }).join('');
            searchResults.classList.remove('hidden');
        } else {
            searchResults.innerHTML = '<div class="p-3 text-gray-500">No se encontraron resultados.</div>';
            searchResults.classList.remove('hidden');
        }
    });

    document.addEventListener('click', (e) => {
        if (!e.target.closest('.relative')) { // Asumiendo que el buscador está en un div relative
            searchResults.classList.add('hidden');
        }
    });
}


// --- 9. INICIALIZACIÓN DE LA APLICACIÓN ---

// Maneja la carga inicial basada en la URL (para compartir enlaces).
function handleInitialScreen() {
    const urlParams = new URLSearchParams(window.location.search);
    const professionalId = urlParams.get('id');
    const screen = window.location.hash.substring(1);

    if (professionalId) {
        showProfessionalDetails(professionalId);
    } else if (screen) {
        showScreen(screen, false);
    } else {
        showScreen('home');
    }
}

// Función principal que inicia la aplicación.
async function init() {
    document.querySelector('body').classList.add('fade-in');
    await loadProfessionalsFromFirestore();
    setupEventListeners();
    initSwiper(); // Inicializar swiper después de cargar datos
    // El observador de auth se encargará de llamar a handleInitialScreen
}

// Arranca todo cuando el DOM está listo.
document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
